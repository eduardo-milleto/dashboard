import{u as be,_ as qe}from"./Bq23fqQe.js";import K from"./D3DlFT73.js";import Ds from"./Dk8HU62_.js";import{u as z,a as Rs,s as ce,C as ue,W as Es,l as se}from"./zNrf90F_.js";import{R as Pe,O as Q,N as c,t as a,v as g,P as N,x as e,z as l,W as ye,_ as $e,T as j,X as pe,y as B,U as D,L as R,A as v,r as _,o as Fe,c as O,Y as Ts,B as U,Z as he,M as Be,H as Z,$ as Ps,a0 as We,a1 as J,Q as Se,a2 as Us,C as Is,D as Os,a3 as me,i as Ke,a4 as Ls,a5 as ze,a6 as Ns,V as Ms,S as _e,a7 as As}from"./Dd7LSZhj.js";import Qe from"./C5Fgqru3.js";import js from"./Cwq-OOhi.js";import de from"./DtHrJouO.js";import Bs from"./D6T1oce1.js";import Ue from"./C83Q7OMs.js";import Ge from"./CZC-FgPX.js";import Xe from"./cF4WE8ou.js";import Ye from"./CApc2wjH.js";import Hs from"./9yX19V7R.js";import{u as Ie,_ as Je}from"./jfI27aO_.js";import Oe from"./DN1E9j_O.js";import{_ as qs,a as Fs,b as Ze}from"./CnmVKiRh.js";import es from"./CfnjS976.js";import Ws from"./DkB9DBNP.js";import Le from"./Bb9xEmOO.js";import{_ as Ks}from"./SCfrK4fh.js";import zs from"./BKHxBNS_.js";import Qs from"./D1UwXfcP.js";import Gs from"./ChSKEA_I.js";import we from"./BF9OqzAw.js";import ss from"./BMNH45Rf.js";import ts from"./D2IvfBak.js";import Xs from"./2rlVORis.js";import Ys from"./Gm48uf-R.js";import os from"./DD7iCx91.js";import ns from"./BOVbxrdD.js";import ls from"./BeJgM5nq.js";import Js from"./xjfYrvYS.js";import Zs from"./Bo42ktFw.js";import et from"./D5pFHxMy.js";import st from"./Bo_Jrbdw.js";function tt(t){return t?Object.keys(t).map(n=>({key:n,value:t[n]})):[]}function ot(t){return t.reduce((n,o)=>(n[o.key]=o.value,n),{})}const nt={key:0},lt={key:1,class:"ml-auto flex align-items-center gap-2 mr-2"},it=e("label",{for:"show-duplicates"},"Hide Duplicates",-1),at={class:"pi pi-info-circle"},rt={__name:"HideDuplicates",setup(t){const n=z(),{hideDuplicatedSessions:o,servers:s}=Pe(n);return n.$subscribe((i,p)=>{Rs(p.hideDuplicatedSessions)}),(i,p)=>{const u=Ds,d=Q("tooltip");return c(s)&&c(s).length<2?(a(),g("div",nt)):(a(),g("div",lt,[it,N(e("i",at,null,512),[[d,`Hide STOPPED sessions with the same "name" .
Useful when you use multiple workers with the same database`]]),l(u,{id:"show-duplicates",modelValue:c(o),"onUpdate:modelValue":p[0]||(p[0]=r=>ye(o)?o.value=r:null)},null,8,["modelValue"])]))}}},ut={class:"metadata"},ct={__name:"Metadata",props:["metadata"],setup(t){return(n,o)=>(a(),g("div",ut,[(a(!0),g(j,null,pe(t.metadata,(s,i)=>(a(),g("pre",{key:i},B(i)+"="+B(s),1))),128))]))}},dt=$e(ct,[["__scopeId","data-v-cb7cbf08"]]),pt={key:0,class:"text-center p-1"},mt={class:"text-center"},vt=e("i",{class:"mr-3 pi pi-user",style:{color:"#34d399"}},null,-1),ge={__name:"ContactChip",props:{id:String,name:String,image:String},setup(t){return(n,o)=>{const s=Ge;return a(),g("div",null,[t.name?(a(),g("div",pt,[e("b",mt,B(t.name),1)])):D("",!0),t.id?(a(),R(s,{key:1,label:t.id,image:t.image,icon:"pi pi-user"},{icon:v(()=>[vt]),_:1},8,["label","image"])):D("",!0)])}}},Ne={__name:"SessionChip",props:{session:Object},setup(t){const n=t,o=z(),s=_(null);return Fe(()=>{var i,p;(p=(i=n.session)==null?void 0:i.me)!=null&&p.id&&o.getProfilePicture(n.session.server.id,n.session.name,n.session.me.id).then(u=>{s.value=u.profilePictureURL})}),(i,p)=>{var u,d,r,m;return a(),R(ge,{id:(d=(u=n.session)==null?void 0:u.me)==null?void 0:d.id,name:(m=(r=n.session)==null?void 0:r.me)==null?void 0:m.pushName,image:c(s)},null,8,["id","name","image"])}}},ve={__name:"RefreshButton",props:["refreshing"],setup(t){const n=t,o=O(()=>n.refreshing?"pi pi-refresh pi-spin":"pi pi-refresh");return(s,i)=>{const p=K;return a(),R(p,{icon:c(o),rounded:"",text:"",disabled:t.refreshing},null,8,["icon","disabled"])}}},ft=["src"],is={__name:"Base64Img",props:{data:String,mimetype:String},setup(t){const n=t,o=O(()=>`data:${n.mimetype};base64, ${n.data}`);return(s,i)=>(a(),g("img",{src:o.value,style:{"max-width":"100%"}},null,8,ft))}},_t={key:2,style:{"background-color":"#f8f9fa",padding:"1rem",color:"red","white-space":"pre-wrap"}},as={__name:"SessionScreenshot",props:{session:Object},setup(t,{expose:n}){const o=z(),s=t,{data:i,pending:p,error:u,refresh:d}=be(`session-screenshot-${s.session.server.id}-${s.session.name}`,async()=>(await ce(1e3),await o.getScreenshot(s.session.server.id,s.session.name)));return n({refresh:d}),(r,m)=>{const S=Xe,k=Ye,b=is;return a(),g(j,null,[c(p)?(a(),g(j,{key:0},[l(S,{mode:"indeterminate",style:{height:"3px"}}),!c(i)&&!c(u)?(a(),R(k,{key:0,width:"100%",height:"20rem"})):D("",!0)],64)):D("",!0),c(i)?(a(),R(b,{key:1,data:c(i).data,mimetype:c(i).mimetype},null,8,["data","mimetype"])):D("",!0),c(u)?(a(),g("pre",_t,""+B(c(u).cause.response.data.message||c(u).cause.response.data||c(u))+`
  `,1)):D("",!0)],64)}}},ht={class:"",style:{"min-width":"20rem"}},gt={class:"flex justify-content-center align-items-center"},bt=e("h5",{class:"m-0"},"Screenshot",-1),yt={class:"m-auto w-full"},$t={__name:"ScreenshotButton",props:["session"],setup(t){const n=t,o=_(null),s=_(null),i=d=>{o.value.toggle(d)},p=()=>{s.value.refresh()},u=O(()=>n.session.status==="STOPPED");return(d,r)=>{const m=K,S=ve,k=as,b=Hs,V=Q("tooltip");return a(),g(j,null,[N(l(m,{disabled:c(u),type:"button",icon:"pi pi-camera",onClick:i,rounded:"",outlined:"",severity:"help"},null,8,["disabled"]),[[V,"Screenshot / QR",void 0,{top:!0}]]),l(b,{ref_key:"op",ref:o,appendTo:"body",showCloseIcon:!0},{default:v(()=>[e("div",ht,[e("div",gt,[bt,l(S,{onClick:p})]),e("div",yt,[l(k,{ref_key:"screenshot",ref:s,session:t.session},null,8,["session"])])])]),_:1},512)],64)}}},St={class:"flex flex-row gap-2 justify-content-end"},rs={__name:"SessionActionButtons",props:["name","isStarting","isRestarting","isStopping","isLoggingOut","isRemoving","allDisabled","hideActions","skipConfirmation","group"],emits:["view","start","restart","stop","logout","delete"],setup(t,{emit:n}){const o=Ts(),s=t,i=n;function p(b){return s.skipConfirmation?!s.skipConfirmation.includes(b):!0}async function u(){if(!p("start")){i("start");return}o.require({group:s.group,target:event.target,message:`Start ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-success p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Start",accept:()=>{i("start")},reject:()=>{}})}const d=O(()=>s.hideActions?!s.hideActions.includes("view"):!0);function r(b){o.require({group:s.group,target:b.target,message:`Restart ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-info p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Restart",accept:()=>{i("restart")},reject:()=>{}})}function m(b){o.require({group:s.group,target:b.target,message:`Stop ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-warning p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Stop",accept:async()=>{i("stop")},reject:()=>{}})}function S(b){o.require({group:s.group,target:b.target,message:`Logout ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-warning p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Logout",accept:async()=>{i("logout")},reject:()=>{}})}function k(b){o.require({group:s.group,target:b.target,message:`Delete ${s.name}?`,icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-danger p-button-sm",rejectLabel:"No",acceptLabel:"Yes, Delete",accept:async()=>{i("delete")},reject:()=>{}})}return(b,V)=>{const y=K,C=es,f=Ws,E=Q("tooltip");return a(),g(j,null,[e("div",St,[c(d)?N((a(),R(y,{key:0,icon:"pi pi-cog",severity:"help",rounded:"",outlined:"",onClick:V[0]||(V[0]=A=>b.$emit("view")),disabled:t.allDisabled},null,8,["disabled"])),[[E,"Configuration",void 0,{top:!0}]]):D("",!0),N(l(y,{icon:"pi pi-play",severity:"success",rounded:"",outlined:"",onClick:u,loading:t.isStarting,disabled:t.allDisabled},null,8,["loading","disabled"]),[[E,"Start",void 0,{top:!0}]]),N(l(y,{icon:"pi pi-replay",severity:"info",rounded:"",outlined:"",onClick:V[1]||(V[1]=A=>r(A)),loading:t.isRestarting,disabled:t.allDisabled},null,8,["loading","disabled"]),[[E,"Restart",void 0,{top:!0}]]),N(l(y,{icon:"pi pi-stop",severity:"secondary",rounded:"",outlined:"",onClick:V[2]||(V[2]=A=>m(A)),loading:t.isStopping,disabled:t.allDisabled},null,8,["loading","disabled"]),[[E,"Stop",void 0,{top:!0}]]),N(l(y,{icon:"pi pi-sign-out",severity:"warning",rounded:"",outlined:"",onClick:V[3]||(V[3]=A=>S(A)),loading:t.isLoggingOut,disabled:t.allDisabled},null,8,["loading","disabled"]),[[E,"Logout",void 0,{top:!0}]]),N(l(y,{icon:"pi pi-trash",severity:"danger",rounded:"",outlined:"",onClick:V[4]||(V[4]=A=>k(A)),loading:t.isRemoving,disabled:t.allDisabled},null,8,["loading","disabled"]),[[E,"Delete",void 0,{top:!0}]])]),t.group==="popup"?(a(),R(C,{key:0,group:"popup"})):D("",!0),t.group==="dialog"?(a(),R(f,{key:1,group:"dialog"})):D("",!0)],64)}}},wt={class:"flex flex-row gap-2 justify-content-end"},xt={__name:"SessionActions",props:["session","disabled"],setup(t,{expose:n}){const o=t,s=z(),i=Ie(),p=_(!1),u=_(!1),d=_(!1),r=_(!1),m=_(!1),S=O(()=>o.disabled||p.value||u.value||d.value||r.value||m.value);async function k(){const f=o.session;r.value=!0,await i(s.startSession(f.server.id,f.name),"Started","Failed to start session",f.name,f.name).finally(()=>r.value=!1)}async function b(){const f=o.session;m.value=!0,await i(s.restartSession(f.server.id,f.name),"Restarted","Failed to restart session",f.name,f.name).finally(()=>m.value=!1)}async function V(){const f=o.session;p.value=!0,await i(s.stopSession(f.server.id,f.name),"Stopped","Failed to stop session",f.name,f.name).finally(()=>p.value=!1)}async function y(){const f=o.session;u.value=!0,await i(s.logoutSession(f.server.id,f.name),"Logged out","Failed to logout session",f.name,f.name).finally(()=>u.value=!1)}async function C(){const f=o.session;d.value=!0,await i(s.deleteSession(f.server.id,f.name),"Deleted","Failed to delete session",f.name,f.name).finally(()=>d.value=!1)}return n({startSession:k,restartSession:b,stopSession:V,logoutSession:y,deleteSession:C}),(f,E)=>{const A=rs;return a(),g("div",wt,[l(A,{group:"popup",name:`'${t.session.name}' session`,onView:E[0]||(E[0]=H=>f.$emit("view",t.session)),onStart:k,onRestart:b,onStop:V,onLogout:y,onDelete:C,"is-starting":c(r),"is-restarting":c(m),"is-stopping":c(p),"is-logging-out":c(u),"is-removing":c(d),"all-disabled":c(S),"hide-actions":[],"skip-confirmation":["start"]},null,8,["name","is-starting","is-restarting","is-stopping","is-logging-out","is-removing","all-disabled"])])}}},kt={class:"p-dialog-title flex gap-2 align-items-center"},Ct=e("i",{class:"pi pi-whatsapp"},null,-1),Vt=e("span",null,"(",-1),Dt={class:"ml-1"},Rt=e("span",null,")",-1),Et=["disabled"],Tt=e("i",{class:"pi pi-refresh"},null,-1),Pt=[Tt],xe={__name:"SessionHeader",props:{session:Object,refresh:Boolean},setup(t){const n=t,o=z(),{refreshing:s}=Pe(o),i=O(()=>n.session.server.id?n.session.server:o.getServer(n.session.server));async function p(){await o.refresh()}return(u,d)=>{var b,V;const r=Je,m=Ks,S=qe,k=Q("tooltip");return a(),g("div",kt,[Ct,e("span",null,B((b=t.session)==null?void 0:b.name),1),l(r,{status:t.session.status,value:(V=t.session.status)==null?void 0:V.toUpperCase()},null,8,["status","value"]),e("div",null,[Vt,l(m,{connected:i.value.connected},null,8,["connected"]),e("span",Dt,B(i.value.name),1),Rt]),t.refresh?N((a(),g("button",{key:0,onClick:d[0]||(d[0]=y=>p()),class:"p-link layout-topbar-button",disabled:c(s)},Pt,8,Et)),[[k,"Refresh",void 0,{top:!0}]]):D("",!0),l(S,{refreshing:c(s)},null,8,["refreshing"])])}}},Ut=e("b",null,"Chats UI",-1),It=e("br",null,null,-1),Ot=e("b",null,"Live Chat",-1),Lt=e("b",null,"Multiple Agents",-1),Nt=e("a",{href:"https://waha.devlike.pro/",target:"_blank"},[e("b",null," WAHA API ")],-1),Mt=e("br",null,null,-1),At=e("ul",null,[e("li",null,[e("a",{href:"https://waha.devlike.pro/docs/how-to/chats/",target:"_blank"},[e("b",null,"Chats API")]),U(" to get chats overview and messages ")]),e("li",null,[e("a",{href:"https://waha.devlike.pro/docs/how-to/send-messages/",target:"_blank"},[e("b",null,"Send API")]),U(" to send messages to chats ")]),e("li",null,[e("a",{href:"https://waha.devlike.pro/docs/how-to/webhooks/#messageack",target:"_blank"},[e("b",null,"Message ACK")]),U(" to get message status ")]),e("li",null,[e("a",{href:"https://waha.devlike.pro/docs/how-to/webhooks/#websockets",target:"_blank"},[e("b",null,"Websockets")]),U(" to get real-time messages on client side ")])],-1),jt={__name:"ChatPromo",emits:["close"],setup(t,{emit:n}){const o=n;return(s,i)=>{const p=zs;return a(),R(p,{onClose:i[0]||(i[0]=u=>o("close"))},{default:v(()=>[U(" It's an example "),Ut,U("."),It,U(" You can implement "),Ot,U(", "),Lt,U(", and more features using "),Nt,U(" :"),Mt,At]),_:1})}}},Bt={class:"flex"},us={__name:"MessageAck",props:{ack:Number},setup(t){const n=t,o={ERROR:-1,PENDING:0,SERVER:1,DEVICE:2,READ:3,PLAYED:4},s=O(()=>{switch(n.ack){case o.ERROR:return"pi-exclamation-circle";case o.PENDING:return"pi-clock";case o.SERVER:return"pi-check";case o.DEVICE:return"pi-check";case o.READ:return"pi-check";case o.PLAYED:return"pi-microphone"}}),i=O(()=>{switch(n.ack){case o.ERROR:return"color: red";case o.PENDING:return"color: blue";case o.SERVER:return"";case o.DEVICE:return"";case o.READ:return"color: blue";case o.PLAYED:return"color: blue"}});return(p,u)=>(a(),g("div",Bt,[e("i",{class:he(["pi",c(s)]),style:Be(c(i))},null,6),t.ack===o.READ||t.ack===o.DEVICE?(a(),g("i",{key:0,class:he(["pi",c(s)]),style:Be([c(i),{"margin-left":"-0.7rem"}])},null,6)):D("",!0)]))}},Ht={class:"p-2"},qt=["innerHTML"],Ft={class:"flex flex-column justify-content-end",style:{height:"100%"}},Wt={__name:"ChatMessage",props:{message:Object},setup(t){return(n,o)=>{const s=Ge;return a(),R(s,null,{default:v(()=>[e("div",Ht,[e("p",{innerHTML:t.message.body.replace(/\n/g,"<br>")},null,8,qt)]),e("div",Ft,[l(us,{ack:t.message.ack,class:"pb-2"},null,8,["ack"])])]),_:1})}}},Kt={class:"flex flex-column gap-2"},zt={__name:"ChatMessages",props:{messages:Array},setup(t){const n=t,o=_(null);async function s(){await ce(10),o.value&&(o.value.scrollTop=o.value.scrollHeight)}return Z(()=>n.messages,s),(i,p)=>{const u=Wt;return a(),g("div",{class:"my-2 pb-3",style:{width:"100%",height:"100%",overflow:"auto"},ref_key:"scroll",ref:o},[e("div",Kt,[(a(!0),g(j,null,pe(t.messages,d=>(a(),g(j,null,[d.body?(a(),g("div",{key:0,class:he({"flex justify-content-end":d.fromMe})},[(a(),R(u,{key:d.key,message:d},null,8,["message"]))],2)):D("",!0)],64))),256))])],512)}}},Qt={class:"flex justify-content-between gap-2 my-2"},Gt={class:"flex gap-2 align-items-center"},Xt={__name:"ChatHeader",props:{chat:Object,me:Object,mePicture:Object,fetching:Boolean,fetch:Function},setup(t){return(n,o)=>{var i;const s=ve;return a(),g("div",Qt,[e("div",Gt,[l(ge,{id:t.chat.name||t.chat.id,image:t.chat.picture},null,8,["id","image"])]),l(s,{onClick:t.fetch,refreshing:t.fetching},null,8,["onClick","refreshing"]),l(ge,{id:(i=t.me)==null?void 0:i.pushName,image:t.mePicture},null,8,["id","image"])])}}},Yt={class:"flex gap-1 mt-1"},He=60,Jt={__name:"ChatPreview",props:{id:String,name:String,picture:String,message:Object},setup(t){const n=t,o=O(()=>{var i,p,u;return((i=n.message)==null?void 0:i.body)?((u=(p=n.message)==null?void 0:p.body)==null?void 0:u.length)>He?n.message.body.slice(0,He)+"...":n.message.body:""});return(s,i)=>(a(),g(j,null,[l(ge,{id:n.name||n.id,image:n.picture},null,8,["id","image"]),e("div",Yt,[c(o)?(a(),R(us,{key:0,ack:t.message.ack,class:"pb-2"},null,8,["ack"])):D("",!0),U(" "+B(c(o)),1)])],64))}},Zt={class:"flex justify-content-center align-items-center gap-1"},eo=e("div",null," Last 20 Chats ",-1),so={__name:"ChatList",props:{chats:Array,pending:Boolean},emits:["clickOnChat","refreshChats"],setup(t,{emit:n}){const o=n;return(s,i)=>{const p=ve,u=Jt,d=Ue,r=Le;return a(),R(r,{value:t.chats,loading:t.pending,class:"p-datatable--clickable",onRowClick:i[1]||(i[1]=m=>o("clickOnChat",m.data)),scrollable:"",scrollHeight:"100%",rowHover:!0},{default:v(()=>[l(d,null,{header:v(()=>[e("div",Zt,[eo,l(p,{onClick:i[0]||(i[0]=m=>o("refreshChats")),refreshing:t.pending},null,8,["refreshing"])])]),body:v(({data:m})=>[l(u,{id:m.id,name:m.name,picture:m.picture,message:m.lastMessage},null,8,["id","name","picture","message"])]),_:1})]),_:1},8,["value","loading"])}}},to={class:"flex justify-content-end"},oo={class:"my-auto pl-2"},no={__name:"ChatInputFooter",props:{disabled:Boolean,sendText:Function},setup(t){const n=t,o=_(!1),s=_("");function i(){o.value=!0,n.sendText(s.value).then(()=>{s.value=""}).finally(()=>{o.value=!1})}return(p,u)=>{const d=ss,r=K;return a(),g("div",to,[e("div",null,[l(d,{class:"w-100",modelValue:c(s),"onUpdate:modelValue":u[0]||(u[0]=m=>ye(s)?s.value=m:null),rows:"2",cols:"50",onKeydown:Ps(We(i,["ctrl"]),["enter"])},null,8,["modelValue","onKeydown"])]),e("div",oo,[l(r,{onClick:i,disabled:t.disabled||!c(s),loading:c(o),label:"",icon:"pi pi-send",class:"p-button-success"},null,8,["disabled","loading"])])])}}},lo={class:"m-auto pb-2"},io={class:"text-center"},ao=e("b",null,"â„¹ï¸ About Chat UI",-1),ro=[ao],uo={class:"pb-3"},co={class:"flex align-items-center"},po={class:"flex flex-column justify-content-between",style:{height:"100%"}},mo=e("hr",null,null,-1),vo={__name:"SessionChatDialog",props:{visible:{},visibleModifiers:{},session:{},sessionModifiers:{}},emits:["update:visible","update:session"],setup(t){const n=J(t,"visible"),o=J(t,"session");Z(n,()=>{n.value||(r.value=null,m.value=[],A())}),Se();const s=z(),{data:i,pending:p,error:u,refresh:d}=be(`session-${o.value.name}-chats`,async()=>await s.getChatsOverview(o.value.server.id,o.value.name,20)),r=_(null),m=_([]),S=_(null);Z(r,()=>{r.value&&H()});const k=_(!1),b=_(20),V=_(0);let y=null;const C=_(ue.DISCONNECTED);function f(){const M=s.getServer(o.value.server.id),L=["message.any"];y=new Es(M,L,o.value.name),y.connect(),C.value=ue.CONNECTING,y.on("open",()=>{C.value=ue.CONNECTED}),y.on("close",()=>{C.value=ue.DISCONNECTED}),y.on("error",()=>{C.value=ue.ERROR}),y.on("event",E)}async function E(M){var w;await ce(100);const L=(w=r.value)==null?void 0:w.id;L&&((M.payload.from===L||M.payload.to===L)&&H(),d())}function A(){y==null||y.stop(),y=null,C.value=ue.DISCONNECTED}function H(){k.value=!0,s.getChatsMessages(o.value.server.id,o.value.name,r.value.id,b.value,V.value,!1).then(M=>{m.value=M.reverse()}).finally(()=>{k.value=!1})}Z(o,()=>{var M,L;(L=(M=o.value)==null?void 0:M.me)!=null&&L.id&&(A(),f(),d(),s.getProfilePicture(o.value.server.id,o.value.name,o.value.me.id).then(w=>{S.value=w.profilePictureURL}))});function T(M){r.value=M}function G(M){return s.sendText(o.value.server.id,o.value.name,r.value.id,M).then(()=>{ce(100)})}const X=_(!1);return(M,L)=>{const w=xe,$=jt,q=Ne,F=Qs,W=Gs,te=we;return a(),R(te,{visible:n.value,"onUpdate:visible":L[2]||(L[2]=oe=>n.value=oe),modal:!0,maximizable:"",style:{width:"90%",height:"90%"}},{header:v(()=>[e("div",null,[l(w,{session:o.value},null,8,["session"])]),e("div",lo,[e("div",io,[e("a",{href:"#",onClick:L[0]||(L[0]=oe=>X.value=!0)},ro)]),X.value?(a(),R($,{key:0,style:{"max-width":"50em"},onClose:L[1]||(L[1]=oe=>X.value=!1)})):D("",!0)])]),default:v(()=>[e("div",uo,[e("div",co,[o.value.me?(a(),R(q,{key:0,session:o.value,image:S.value},null,8,["session","image"])):D("",!0),l(qs,{status:C.value},null,8,["status"])])]),l(W,{style:{"max-height":"90%"}},{default:v(()=>[l(F,{size:30,class:"flex items-center justify-center"},{default:v(()=>[l(so,{chats:c(i),loading:c(p),onClickOnChat:T,onRefreshChats:c(d)},null,8,["chats","loading","onRefreshChats"])]),_:1}),l(F,{size:70,class:"flex flex-column gap-2 justify-content-between p-2"},{default:v(()=>[e("div",po,[r.value?(a(),g(j,{key:0},[l(Xt,{chat:r.value,me:o.value.me,mePicture:S.value,fetch:H,fetching:k.value},null,8,["chat","me","mePicture","fetching"]),mo,l(zt,{messages:m.value},null,8,["messages"]),l(no,{disabled:!r.value||k.value,sendText:G},null,8,["disabled"])],64)):D("",!0)])]),_:1})]),_:1})]),_:1},8,["visible"])}}},fo={class:"-mt-4 p-0 line-height-3 block",style:{"font-family":"monaco, Consolas, 'Lucida Console', monospace"}},_o={__name:"CodeHighlight",props:["invalid"],setup(t){const n=t,o=O(()=>n.invalid?"p-invalid p-component p-inputtext":"");return(s,i)=>(a(),g("pre",{class:he(["border-round surface-ground text-900 p-5 overflow-auto",o.value])},[U("        "),e("code",fo,[Us(s.$slots,"default")])],2))}},Me=t=>(Is("data-v-aa1b18ec"),t=t(),Os(),t),ho={class:"h-full flex flex-column"},go={class:"flex justify-content-center align-items-center"},bo=Me(()=>e("h5",{class:"m-0"},"Request",-1)),yo={class:"flex flex-column justify-content-between h-full"},$o={class:"flex flex-column gap-2"},So={class:"flex gap-2"},wo={class:"text-center"},xo=Me(()=>e("div",{class:"mb-2"},"Body",-1)),ko={class:"text-center mt-2"},Co={class:"flex flex-column h-full"},Vo={class:"flex justify-content-center align-items-center"},Do=Me(()=>e("h5",{class:"m-0"},"Response",-1)),Ro={__name:"SessionRequestResponse",props:["session"],setup(t){const n=z(),o=t,s=_(null),i=_("POST"),p=_("/api/sendText"),u=_(""),d=_(!1),r=_(!1);function m(f){return JSON.stringify(f,null,2)}function S(f){try{return JSON.parse(f)}catch{return f}}const k=O(()=>({method:i.value,uri:p.value,params:void 0,body:S(u.value)})),b=["GET","POST","PUT","DELETE","PATCH"];async function V(f){await navigator.clipboard.writeText(s.value),f.preventDefault()}async function y(f){await navigator.clipboard.writeText(m(k.value)),f.preventDefault()}async function C(){try{r.value=!1,d.value=!0;const f=await n.callServerAPI(o.session.server.id,k.value);s.value=m(f)}catch(f){r.value=!0,f.response?s.value=m(f.response.data):s.value=m(f)}finally{d.value=!1}}return Fe(()=>{const f={chatId:"11111111111@c.us",text:"Hi there!",session:o.session.name};u.value=m(f),s.value="..."}),(f,E)=>{const A=K,H=Oe,T=de,G=ss,X=ts,M=_o,L=Q("tooltip");return a(),g(j,null,[e("div",null,[e("div",ho,[e("div",go,[bo,N(l(A,{rounded:"",text:"",tabindex:0,icon:"pi pi-copy",onClick:E[0]||(E[0]=w=>y(w))},null,512),[[L,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]])]),e("div",yo,[e("div",$o,[e("div",So,[l(H,{modelValue:i.value,"onUpdate:modelValue":E[1]||(E[1]=w=>i.value=w),options:b},null,8,["modelValue"]),l(T,{type:"text",class:"w-full",modelValue:p.value,"onUpdate:modelValue":E[2]||(E[2]=w=>p.value=w),placeholder:"API Endpoint"},null,8,["modelValue"])]),e("div",wo,[xo,l(G,{modelValue:u.value,"onUpdate:modelValue":E[3]||(E[3]=w=>u.value=w),rows:"8",class:"w-full",placeholder:"Request"},null,8,["modelValue"])])]),e("div",ko,[l(A,{onClick:C,loading:d.value,label:"Send",icon:"pi pi-send","icon-pos":"right"},null,8,["loading"])])])])]),l(X),e("div",null,[e("div",Co,[e("div",Vo,[Do,N(l(A,{rounded:"",text:"",tabindex:0,icon:"pi pi-copy",onClick:E[4]||(E[4]=w=>V(w))},null,512),[[L,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]])]),l(M,{class:"m-0 p-4 pretty",invalid:r.value},{default:v(()=>[U(B(s.value),1)]),_:1},8,["invalid"])])])],64)}}},Eo=$e(Ro,[["__scopeId","data-v-aa1b18ec"]]),To={class:"grid pt-4"},Po={class:"col-12 sm:col-6 h-full"},Uo={class:"grid"},Io={class:"col-12"},Oo={class:""},Lo={class:"flex justify-content-center align-items-center"},No={class:"col-12"},Mo={class:""},Ao={class:"flex justify-content-center align-items-center"},jo=e("h5",{class:"m-0"},"Screenshot",-1),Bo={class:"m-auto w-full"},Ho={class:"col-12 sm:col-6 h-full card"},qo={__name:"SessionControl",props:["session"],setup(t){const n=_(null),o=()=>{n.value.refresh()};return(s,i)=>{const p=Ne,u=ve,d=as,r=Eo;return a(),g("div",To,[e("div",Po,[e("div",Uo,[e("div",Io,[e("div",Oo,[e("div",Lo,[t.session.me?(a(),R(p,{key:0,session:t.session},null,8,["session"])):D("",!0)])])]),e("div",No,[e("div",Mo,[e("div",Ao,[jo,l(u,{onClick:o})]),e("div",Bo,[l(d,{ref_key:"screenshot",ref:n,session:t.session},null,8,["session"])])])])])]),e("div",Ho,[l(r,{session:t.session},null,8,["session"])])])}}},Fo={__name:"SessionControlDialog",props:{visible:{},visibleModifiers:{},session:{},sessionModifiers:{}},emits:["update:visible","update:session"],setup(t){const n=J(t,"visible"),o=J(t,"session");return Se(),(s,i)=>{const p=xe,u=qo,d=we;return a(),R(d,{visible:n.value,"onUpdate:visible":i[0]||(i[0]=r=>n.value=r),modal:!0,maximizable:""},{header:v(()=>[l(p,{session:o.value},null,8,["session"])]),default:v(()=>[l(u,{session:o.value},null,8,["session"])]),_:1},8,["visible"])}}},Wo={class:"card p-fluid"},Ko={class:"flex flex-grow-1 justify-content-center"},zo={class:"flex flex-grow-1 justify-content-center"},cs={__name:"KeyValueTable",props:me(["keyColumn","keyColumnName","prefix","entityName"],{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const n=J(t,"modelValue"),o=t,s=_([]),i=r=>{let{newData:m,index:S}=r;n.value[S]=m},p=r=>{let{data:m,newValue:S,field:k}=r;m[k]=S};function u(){const r=n.value.length+1,m=`${o.prefix}${r}`;n.value.unshift({[o.keyColumn]:m,value:"123"})}function d(r){n.value.splice(r,1)}return(r,m)=>{const S=de,k=Ue,b=K,V=Le,y=Q("tooltip");return a(),g("div",Wo,[l(V,{editingRows:s.value,"onUpdate:editingRows":m[0]||(m[0]=C=>s.value=C),value:n.value,editMode:"cell",dataKey:o.keyColumn,onRowEditSave:i,onCellEditComplete:p,pt:{table:{style:"min-width: 50rem"},column:{bodycell:({state:C})=>({style:C.d_editing&&"padding-top: 0.6rem; padding-bottom: 0.6rem"})}},resizableColumns:""},{default:v(()=>[l(k,{field:o.keyColumn,header:o.keyColumnName,style:{width:"40%"}},{editor:v(({data:C,field:f})=>[l(S,{modelValue:C[f],"onUpdate:modelValue":E=>C[f]=E},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["field","header"]),l(k,{style:{width:"40%"},field:"value",header:"Value"},{editor:v(({data:C,field:f})=>[l(S,{modelValue:C[f],"onUpdate:modelValue":E=>C[f]=E},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(k,{style:{"min-width":"1rem"}},{header:v(()=>[e("div",Ko,[N(l(b,{label:t.entityName,text:"",icon:"pi pi-plus",severity:"success",onClick:u},null,8,["label"]),[[y,`Add ${t.entityName}`,void 0,{top:!0}]])])]),body:v(({index:C})=>[e("div",zo,[N(l(b,{label:"",rounded:"",text:"",style:{height:"2rem",width:"2rem"},icon:"pi pi-trash",severity:"warning",onClick:f=>d(C)},null,8,["onClick"]),[[y,"Delete",void 0,{top:!0}]])])]),_:1})]),_:1},8,["editingRows","value","dataKey","pt"])])}}},Qo={class:"flex justify-content-between align-items-center w-full"},Go={class:"field"},Xo=e("label",{for:"url"},"URL",-1),Yo={class:"field mb-4"},Jo=e("label",{for:"events"},"Events",-1),Zo=e("div",{class:"font-bold mb-2"},"Retries",-1),en={class:"flex gap-3"},sn={class:"field",style:{width:"10em"}},tn=e("label",{for:"retries-attempts"},"Attempts",-1),on=e("span",{class:"pi pi-plus"},null,-1),nn=e("span",{class:"pi pi-minus"},null,-1),ln={class:"field",style:{width:"10em"}},an=e("label",{for:"retries-delay-seconds"},"Delay, seconds",-1),rn=e("span",{class:"pi pi-plus"},null,-1),un=e("span",{class:"pi pi-minus"},null,-1),cn={class:"field"},dn={for:"retries-delay-policy"},pn={class:"pi pi-info-circle"},mn={style:{"text-transform":"capitalize"}},vn={style:{"text-transform":"capitalize"}},fn={class:"field"},_n=e("label",{for:"hmac"},"HMAC Key (optional)",-1),hn={class:"field"},gn={class:"field flex justify-content-between align-items-center"},bn=e("div",null,[e("label",{for:"hmac"},"Custom Headers (optional)")],-1),yn={__name:"SessionWebhook",props:me({disabled:Boolean,index:Number},{webhook:{},webhookModifiers:{}}),emits:["update:webhook"],setup(t){const n=J(t,"webhook"),o=t,s=["constant","linear","exponential"],i=O(()=>{var b;const d=((b=n.value.retries)==null?void 0:b.delaySeconds)??2,r=4,m=Array.from({length:r},(V,y)=>d),S=Array.from({length:r},(V,y)=>d*(y+1)),k=Array.from({length:r},(V,y)=>d*2**y);return[`Constant: ${m.join(", ")}`,`Linear: ${S.join(", ")}`,`Exponential: ${k.join(", ")}`].join(`
`)}),p=Fs,u=_(n.value.customHeaders&&n.value.customHeaders.length>0);return Z(u,(d,r)=>{if(r&&!d){n.value.customHeaders=null;return}!r&&d&&(n.value.customHeaders=[{name:"X-Header-1",value:"123"}])}),(d,r)=>{const m=K,S=de,k=Qe,b=Js,V=Oe,y=Ke("font-awesome-icon"),C=os,f=cs,E=ns,A=ls,H=Q("tooltip");return a(),R(A,{activeIndex:0},{default:v(()=>[l(E,null,{header:v(()=>[e("div",Qo,[e("div",null," Webhook "+B(o.index+1),1),e("div",null,[N(l(m,{label:"",text:"",rounded:"",style:{height:"2rem",width:"2rem"},icon:"pi pi-trash",severity:"warning",onClick:r[0]||(r[0]=T=>d.$emit("remove"))},null,512),[[H,"Delete Webhook",void 0,{top:!0}]])])])]),default:v(()=>[e("div",Go,[Xo,l(S,{id:"url",modelValue:n.value.url,"onUpdate:modelValue":r[1]||(r[1]=T=>n.value.url=T),modelModifiers:{trim:!0},required:"true",disabled:t.disabled},null,8,["modelValue","disabled"])]),e("div",Yo,[Jo,l(k,{id:"events",modelValue:n.value.events,"onUpdate:modelValue":r[2]||(r[2]=T=>n.value.events=T),options:c(p),placeholder:"Select Events","max-selected-labels":1,selectedItemsLabel:"{0} events selected",disabled:t.disabled},null,8,["modelValue","options","disabled"]),e("ul",null,[(a(!0),g(j,null,pe(n.value.events,T=>(a(),g("li",{key:T},B(T),1))),128))])]),e("div",null,[Zo,e("div",en,[e("div",sn,[tn,l(b,{modelValue:n.value.retries.attempts,"onUpdate:modelValue":r[3]||(r[3]=T=>n.value.retries.attempts=T),inputId:"retries-delay-attempts",showButtons:"",buttonLayout:"horizontal",min:1,step:1,disabled:t.disabled},{incrementbuttonicon:v(()=>[on]),decrementbuttonicon:v(()=>[nn]),_:1},8,["modelValue","disabled"])]),e("div",ln,[an,l(b,{modelValue:n.value.retries.delaySeconds,"onUpdate:modelValue":r[4]||(r[4]=T=>n.value.retries.delaySeconds=T),inputId:"retries-delay-seconds",showButtons:"",buttonLayout:"horizontal",min:1,step:1,disabled:t.disabled},{incrementbuttonicon:v(()=>[rn]),decrementbuttonicon:v(()=>[un]),_:1},8,["modelValue","disabled"])]),e("div",cn,[e("label",dn,[U(" Retry Policy "),N(e("i",pn,null,512),[[H,c(i)]])]),l(V,{id:"retries-delay-policy",modelValue:n.value.retries.policy,"onUpdate:modelValue":r[5]||(r[5]=T=>n.value.retries.policy=T),options:s,placeholder:"Select Retry Policy","max-selected-labels":1,disabled:t.disabled},{option:v(T=>[e("span",mn,B(T.option),1)]),value:v(T=>[e("span",vn,B(T.value),1)]),_:1},8,["modelValue","disabled"])])])]),e("div",fn,[_n,l(S,{id:"hmac",modelValue:n.value.hmac.key,"onUpdate:modelValue":r[6]||(r[6]=T=>n.value.hmac.key=T),modelModifiers:{trim:!0},disabled:t.disabled},null,8,["modelValue","disabled"])]),e("div",hn,[e("div",gn,[bn,l(C,{modelValue:u.value,"onUpdate:modelValue":r[7]||(r[7]=T=>u.value=T),id:"customHeaders",onLabel:"Headers On",offLabel:"Headers Off"},{icon:v(()=>[l(y,{icon:"fa-solid fa-fingerprint",class:"mr-2"})]),_:1},8,["modelValue"])]),u.value?(a(),R(f,{key:0,modelValue:n.value.customHeaders,"onUpdate:modelValue":r[8]||(r[8]=T=>n.value.customHeaders=T),"entity-name":"Header","key-column":"name","key-column-name":"Header",prefix:"X-Header-"},null,8,["modelValue"])):D("",!0)])]),_:1})]),_:1})}}},$n={class:"flex flex-column gap-2"},Sn={class:"flex justify-content-between align-items-center w-full"},wn=e("h5",null,"ðŸ”„ Webhooks",-1),xn={class:"pr-2"},kn={key:0,class:"text-300 text-center"},Cn={__name:"SessionWebhooksField",props:me({disabled:Boolean},{webhooks:{},webhooksModifiers:{}}),emits:["update:webhooks"],setup(t){const n=J(t,"webhooks");function o(){const i={url:"https://httpbin.org/post",events:["session.status","message"],hmac:{key:null},retries:{delaySeconds:2,attempts:15,policy:"exponential"},customHeaders:null};n.value.push(i)}function s(i){n.value.splice(i,1)}return(i,p)=>{const u=K,d=yn,r=Q("tooltip");return a(),g("div",$n,[e("div",Sn,[wn,e("div",xn,[N(l(u,{label:"Webhook",text:"",icon:"pi pi-plus",severity:"success",onClick:o},null,512),[[r,"Add Webhook",void 0,{top:!0}]])])]),n.value.length===0?(a(),g("div",kn," No webhooks configured ")):(a(!0),g(j,{key:1},pe(n.value,(m,S)=>(a(),R(d,{webhook:n.value[S],"onUpdate:webhook":k=>n.value[S]=k,index:S,total:n.value.length,onRemove:k=>s(S),disabled:t.disabled},null,8,["webhook","onUpdate:webhook","index","total","onRemove","disabled"]))),256))])}}},Vn=e("div",null,[e("h5",null,[e("i",{class:"pi pi-whatsapp"}),U(" Create Session ")])],-1),Dn={class:"mb-2"},Rn=e("b",null,"Server",-1),En=e("b",null,"Name",-1),Tn={class:"field"},Pn=e("label",{for:"server"},"Server",-1),Un={key:0,class:"p-invalid"},In={class:"field"},On=e("label",{for:"name"},"Name (optional)",-1),Ln={key:0,class:"mb-4"},Nn=e("div",{class:"mb-3"},[e("h5",null,"ðŸ­ Engine Settings ")],-1),Mn={class:"flex flex-column gap-2"},An=e("div",null,[e("a",{href:"https://waha.devlike.pro/docs/engines/noweb",target:"_blank"},"Read more about NOWEB settings")],-1),jn={class:"flex gap-2"},Bn={class:"pi pi-info-circle"},Hn={class:"field mt-4"},qn={class:"field flex justify-content-between align-items-center"},Fn=e("div",null,[e("h5",null,[e("label",{for:"proxy"},"ðŸŒ Proxy")])],-1),Wn={key:0,class:"card mb-4"},Kn={class:"field"},zn=e("label",{for:"proxy-server"},"Server",-1),Qn={key:0,class:"p-invalid"},Gn={class:"flex gap-3"},Xn={class:"field w-full"},Yn=e("label",{for:"proxy-username"},"Username (optional)",-1),Jn={class:"field w-full"},Zn=e("label",{for:"proxy-password"},"Password (optional)",-1),el={class:"field flex justify-content-between align-items-center"},sl=e("div",null,[e("h5",null,[e("label",{for:"debug"},"ðŸ› ï¸ Debug")])],-1),tl={class:"w-full flex flex-column gap-2"},ol={class:"flex justify-content-end"},nl={__name:"SessionDialog",props:me({mode:String},{visible:{},visibleModifiers:{},session:{},sessionModifiers:{}}),emits:["update:visible","update:session"],setup(t){var M,L;const n=Se(),o=J(t,"visible"),s=J(t,"session"),i=t,p=O(()=>i.mode==="new"),u=O(()=>i.mode==="update"),d=O(()=>u.value),r=Ie(),m=z(),S=O(()=>m.getServer(s.value.server)),k=O(()=>{var w,$;return(($=(w=S.value)==null?void 0:w.version)==null?void 0:$.engine)==="NOWEB"});O(()=>{var w,$;return(($=(w=S.value)==null?void 0:w.version)==null?void 0:$.engine)==="WEBJS"});const b=_([]),V=_(!!((L=(M=s.value.config)==null?void 0:M.proxy)!=null&&L.server));Z(s,async(w,$)=>{var q,F,W;V.value=(F=(q=w==null?void 0:w.config)==null?void 0:q.proxy)==null?void 0:F.server,b.value=tt((W=w.config)==null?void 0:W.metadata)});const y=_(!1),C=_(!1),f=O(()=>{const w=se.cloneDeep(s.value.config);return V.value||(w.proxy=void 0),w.metadata=ot(b.value),w}),E=O(()=>{const w={...f.value};return k.value||delete w.noweb,{name:s.value.name,config:w}});async function A(){y.value=!0;try{C.value=!0;const w=se.cloneDeep(E.value);await r(m.updateSession(s.value.server,s.value.name,w.config),void 0,"Failed to update session"),n.add({severity:"success",summary:"Updated",detail:s.value.name,life:3e3})}finally{C.value=!1}s.value=void 0,T()}async function H(w){y.value=!0;try{C.value=!0;const $=se.cloneDeep(E.value);$.start=w;const q=await r(m.createSession(s.value.server,$),void 0,"Failed to start session"),F=w?"Started":"Created";n.add({severity:"success",summary:F,detail:q.name,life:3e3})}finally{C.value=!1}s.value=void 0,T()}function T(){y.value=!1,o.value=!1}const G=O(()=>s.value.status==="STOPPED");async function X(w){await navigator.clipboard.writeText(JSON.stringify({method:"POST",uri:"/api/sessions",body:E.value},null,2)),w.preventDefault()}return(w,$)=>{const q=xe,F=Xs,W=Ze,te=de,oe=Ys,ne=Ke("font-awesome-icon"),le=os,ke=ns,Ce=ls,Ve=cs,De=Cn,Re=Zs,re=K,Ee=we,ie=Q("tooltip");return a(),R(Ee,{visible:o.value,"onUpdate:visible":$[15]||($[15]=P=>o.value=P),modal:!0,class:"p-fluid",maximizable:""},Ls({footer:v(()=>[e("div",tl,[e("div",null,[u.value&&!G.value?(a(),R(F,{key:0,severity:"warn"},{default:v(()=>[U(" The session is in '"),e("b",null,B(s.value.status)+"'",1),U(" status, in order to save configuration the session will be restarted. ")]),_:1})):D("",!0)]),e("div",ol,[N(l(re,{label:"Copy",text:"",tabindex:0,icon:"pi pi-copy",severity:"secondary",onClick:$[12]||($[12]=P=>X(P))},null,512),[[ie,{value:"Copied to clipboard"},void 0,{focus:!0,bottom:!0}]]),u.value?D("",!0):(a(),R(re,{key:0,label:"Create",icon:"pi pi-plus",text:"",onClick:$[13]||($[13]=P=>H(!1)),loading:C.value},null,8,["loading"])),u.value?D("",!0):(a(),R(re,{key:1,label:"Create & Start",icon:"pi pi-play",text:"",onClick:$[14]||($[14]=P=>H(!0)),loading:C.value},null,8,["loading"])),u.value?(a(),R(re,{key:2,label:"Update",icon:"pi pi-save",text:"",onClick:A,loading:C.value},null,8,["loading"])):D("",!0)])])]),default:v(()=>[e("div",Dn,[u.value?(a(),R(F,{key:0,severity:"info"},{default:v(()=>[U(" To change the "),Rn,U(" or "),En,U(" - please remove the session and run again. ")]),_:1})):D("",!0)]),e("div",Tn,[Pn,l(W,{placeholder:"Select Server",modelValue:s.value.server,"onUpdate:modelValue":$[0]||($[0]=P=>s.value.server=P),showClear:!1,required:!0,invalid:y.value&&!s.value.server,disabled:d.value},null,8,["modelValue","invalid","disabled"]),y.value&&!s.value.server?(a(),g("small",Un,"Server is required.")):D("",!0)]),e("div",In,[On,l(te,{id:"name",modelValue:s.value.name,"onUpdate:modelValue":$[1]||($[1]=P=>s.value.name=P),modelModifiers:{trim:!0},required:"false",autofocus:"",placeholder:"session_1111111111111",disabled:!p.value},null,8,["modelValue","disabled"])]),k.value?(a(),g("div",Ln,[Nn,l(Ce,{activeIndex:0},{default:v(()=>[l(ke,{header:"NOWEB"},{header:v(()=>[U(" Â "),l(oe,{value:"New"})]),default:v(()=>[e("div",Mn,[An,e("div",null,[N((a(),R(le,{modelValue:s.value.config.noweb.markOnline,"onUpdate:modelValue":$[2]||($[2]=P=>s.value.config.noweb.markOnline=P),onLabel:"Presence: online",offLabel:"Presence: offline",disabled:d.value},{icon:v(()=>[l(ne,{icon:"fa-solid fa-sync",class:"mr-2"})]),_:1},8,["modelValue","disabled"])),[[ie,"Send presence when connect for the connected session. If presence online - you don not get notifications in your phone"]])]),e("div",jn,[e("div",null,[N((a(),R(le,{modelValue:s.value.config.noweb.store.enabled,"onUpdate:modelValue":$[3]||($[3]=P=>s.value.config.noweb.store.enabled=P),onLabel:"Store: Enabled",offLabel:"Store: Disabled",disabled:d.value},{icon:v(()=>[l(ne,{icon:"fa-solid fa-folder",class:"mr-2"})]),_:1},8,["modelValue","disabled"])),[[ie,"Store contacts, chats, messages in the database, so you can get it in API"]])]),e("div",null,[N((a(),R(le,{modelValue:s.value.config.noweb.store.fullSync,"onUpdate:modelValue":$[4]||($[4]=P=>s.value.config.noweb.store.fullSync=P),onLabel:"Store: Full Sync On",offLabel:"Store: Full Sync Off",disabled:d.value},{icon:v(()=>[l(ne,{icon:"fa-solid fa-sync",class:"mr-2"})]),_:1},8,["modelValue","disabled"])),[[ie,`Sync all contacts, chats, messages from the phone at the start.
Otherwise the store can miss some information.`]])])])])]),_:1})]),_:1})])):D("",!0),e("div",null,[e("div",null,[e("h5",null,[U("ðŸ“ Metadata "),N(e("i",Bn,null,512),[[ie,"Key value pairs you can attach to Session and will receive it in webhooks, API and search the values on Dashboard."]])])]),l(Ve,{modelValue:b.value,"onUpdate:modelValue":$[5]||($[5]=P=>b.value=P),"entity-name":"Metadata","key-column":"key","key-column-name":"Key",prefix:"user.id."},null,8,["modelValue"])]),e("div",Hn,[l(De,{ref:"webhooks",webhooks:s.value.config.webhooks,"onUpdate:webhooks":$[6]||($[6]=P=>s.value.config.webhooks=P)},null,8,["webhooks"])]),e("div",null,[e("div",qn,[Fn,l(le,{modelValue:V.value,"onUpdate:modelValue":$[7]||($[7]=P=>V.value=P),id:"proxy",onLabel:"Proxy On",offLabel:"Proxy Off"},{icon:v(()=>[l(ne,{icon:"fa-solid fa-server",class:"mr-2"})]),_:1},8,["modelValue"])]),V.value?(a(),g("div",Wn,[e("div",Kn,[zn,l(te,{id:"proxy-server",modelValue:s.value.config.proxy.server,"onUpdate:modelValue":$[8]||($[8]=P=>s.value.config.proxy.server=P),modelModifiers:{trim:!0},required:"true",invalid:y.value&&!s.value.config.proxy.server,placeholder:"host:port"},null,8,["modelValue","invalid"]),y.value&&!s.value.config.proxy.server?(a(),g("small",Qn,"Server is required.")):D("",!0)]),e("div",Gn,[e("div",Xn,[Yn,l(te,{id:"proxy-username",modelValue:s.value.config.proxy.username,"onUpdate:modelValue":$[9]||($[9]=P=>s.value.config.proxy.username=P),modelModifiers:{trim:!0}},null,8,["modelValue"])]),e("div",Jn,[Zn,l(Re,{id:"proxy-password",modelValue:s.value.config.proxy.password,"onUpdate:modelValue":$[10]||($[10]=P=>s.value.config.proxy.password=P),modelModifiers:{trim:!0},feedback:!1,toggleMask:""},null,8,["modelValue"])])])])):D("",!0)]),e("div",el,[sl,l(le,{modelValue:s.value.config.debug,"onUpdate:modelValue":$[11]||($[11]=P=>s.value.config.debug=P),onLabel:"Debug Enabled",offLabel:"Debug Disabled",onIcon:"fa fa-bug"},{icon:v(()=>[l(ne,{icon:"fa-solid fa-bug",class:"mr-2"})]),_:1},8,["modelValue"])])]),_:2},[p.value?{name:"header",fn:v(()=>[Vn]),key:"0"}:void 0,p.value?void 0:{name:"header",fn:v(()=>[e("div",null,[l(q,{session:s.value},null,8,["session"])])]),key:"1"}]),1032,["visible"])}}},ll=["WORKING","FAILED","STARTING","SCAN_QR_CODE","STOPPED"],il={class:"",style:{"min-width":"20rem"}},al={class:"flex justify-content-center align-items-center"},rl=e("h5",{class:"m-0"},"QR",-1),ul={class:"m-auto w-full"},cl={class:"flex justify-content-center"},dl={key:1,style:{"background-color":"#f8f9fa",padding:"1rem",color:"red","white-space":"pre-wrap"}},pl={__name:"QRImage",props:{session:Object},setup(t){const n=z(),o=t,{data:s,pending:i,error:p,refresh:u}=be(`session-qr-${o.session.server.id}-${o.session.name}`,async()=>(await ce(1e3),await n.getQR(o.session.server.id,o.session.name)));return(d,r)=>{const m=ve,S=Xe,k=Ye,b=is;return a(),g("div",il,[e("div",al,[rl,l(m,{onClick:c(u)},null,8,["onClick"])]),e("div",ul,[c(i)?(a(),g(j,{key:0},[l(S,{mode:"indeterminate",style:{height:"3px"}}),!c(s)&&!c(p)?(a(),R(k,{key:0,width:"100%",height:"20rem"})):D("",!0)],64)):D("",!0),e("div",cl,[c(s)?(a(),R(b,{key:0,data:c(s).data,mimetype:c(s).mimetype},null,8,["data","mimetype"])):D("",!0),c(p)?(a(),g("pre",dl,""+B(c(p).cause.response.data.message||c(p).cause.response.data||c(p))+`
  `,1)):D("",!0)])])])}}},ml={},vl={class:"pl-4"},fl=ze('<li> Open <b>WhatsApp</b> on your phone </li><li> Tap <b>More options</b> <i class="pi pi-ellipsis-v"></i> or <b>Settings</b> <i class="pi pi-cog"></i></li><li> Tap <b>Linked Devices</b> &gt; <b>Link a device</b></li><li><b>Link with phone number instead</b> and enter the code </li>',4),_l=[fl];function hl(t,n){return a(),g("ul",vl,_l)}const gl=$e(ml,[["render",hl]]),bl={class:"flex flex-column gap-2 mt-4"},yl={class:"flex justify-content-between gap-2"},$l={class:"field"},Sl={class:"card flex justify-content-center align-items-center"},wl={class:"mx-1",style:{"font-size":"2rem"}},xl={__name:"PairingCodeSteps",props:["session"],setup(t){const n=t,o=_(null),s=_(!1),i=_("XXXX-XXXX"),p=Ie(),u=z();function d(m){return m.replace(/\D/g,"")}async function r(){o.value=d(o.value),s.value=!0;try{await ce(1e3);const m=await p(u.getPairingCode(n.session.server.id,n.session.name,o.value),"Request sent","Failed to request code",n.session.name,n.session.name);i.value=m.code}finally{s.value=!1}}return Z(o,se.debounce(m=>{o.value=d(m)},1e3)),(m,S)=>{const k=de,b=K,V=ts;return a(),g(j,null,[e("div",bl,[e("form",{onSubmit:We(r,["prevent"])},[e("div",yl,[e("div",$l,[l(k,{id:"phone","input-id":"phone",name:"phone",modelValue:c(o),"onUpdate:modelValue":S[0]||(S[0]=y=>ye(o)?o.value=y:null),modelModifiers:{trim:!0},useGrouping:!1,required:"true",autofocus:"",placeholder:"1213213213 (no +, no dashes -)"},null,8,["modelValue"])]),e("div",null,[l(b,{type:"submit",label:"Show Code",icon:"pi pi-send",loading:c(s)},null,8,["loading"])])])],32)]),c(i)?(a(),g(j,{key:0},[l(V),e("div",null,[l(gl)]),e("div",Sl,[e("div",null,[c(i)?(a(!0),g(j,{key:0},pe(c(i),y=>(a(),g("span",wl,B(y),1))),256)):D("",!0)])])],64)):D("",!0)],64)}}},kl={},Cl={class:"pl-4"},Vl=ze('<li> Open <b>WhatsApp</b> on your phone </li><li> Tap <b>More options</b> <i class="pi pi-ellipsis-v"></i> or <b>Settings</b> <i class="pi pi-cog"></i></li><li> Tap <b>Linked Devices</b> and <b>Link a device</b></li><li> Point your phone to this screen to capture <b>QR code</b></li>',4),Dl=[Vl];function Rl(t,n){return a(),g("ul",Cl,Dl)}const El=$e(kl,[["render",Rl]]),Tl=e("i",{class:"pi pi-qrcode mr-2"},null,-1),Pl=e("p",null,[U(" Scan "),e("b",null,"QR Code"),U(" to authorize this session. ")],-1),Ul=e("i",{class:"pi pi-send mr-2"},null,-1),Il=e("p",{class:"m-0"},[U(" Enter "),e("b",null,"Your Phone number"),U(": ")],-1),Ol={__name:"SessionLoginDialog",props:me(["session"],{visible:{},visibleModifiers:{}}),emits:["update:visible"],setup(t){const n=J(t,"visible");return(o,s)=>{const i=et,p=st,u=we;return a(),R(u,{visible:n.value,"onUpdate:visible":s[0]||(s[0]=d=>n.value=d),modal:!0,class:"p-fluid",maximizable:""},{header:v(()=>[l(xe,{session:t.session},null,8,["session"])]),default:v(()=>[l(p,null,{default:v(()=>[l(i,null,{header:v(()=>[Tl,U(" Scan QR ")]),default:v(()=>[Pl,l(El),e("div",null,[l(pl,{session:t.session},null,8,["session"])])]),_:1}),l(i,null,{header:v(()=>[Ul,U(" Enter Code ")]),default:v(()=>[Il,e("div",null,[l(xl,{session:t.session},null,8,["session"])])]),_:1})]),_:1})]),_:1},8,["visible"])}}},Ll={__name:"SessionLogin",props:["session"],setup(t){const n=_(!1);return(o,s)=>{const i=K,p=Q("tooltip");return a(),g(j,null,[N(l(i,{icon:"pi pi-sign-in",severity:"",rounded:"",outlined:"",onClick:s[0]||(s[0]=u=>n.value=!0),disabled:t.session.status!=="SCAN_QR_CODE"},null,8,["disabled"]),[[p,"Login",void 0,{top:!0}]]),l(Ol,{visible:c(n),"onUpdate:visible":s[1]||(s[1]=u=>ye(n)?n.value=u:null),session:t.session},null,8,["visible","session"])],64)}}},Nl={class:"flex justify-content-between"},Ml={class:"flex align-items-center gap-1"},Al=e("i",{class:"pi pi-whatsapp"},null,-1),jl=e("span",{class:"mr-1"}," Sessions ",-1),Bl=["disabled"],Hl=e("i",{class:"pi pi-refresh"},null,-1),ql=[Hl],Fl={class:"flex justify-content-between flex-column sm:flex-row gap-2 sm:gap-0"},Wl={class:"flex flex-column"},Kl={class:"flex justify-content-between flex-column sm:flex-row gap-2 sm:gap-2"},zl={style:{"text-align":"left"},class:"flex flex-column"},Ql={class:"text-center"},Gl={class:"flex gap-2"},Xl={class:"my-auto"},Yl={key:0,class:"pi pi-info-circle text-orange-400"},Jl={class:"flex flex-row gap-2 justify-content-end",style:{order:"2"}},Oi={__name:"SessionTable",setup(t){const n=Se(),o=z(),{visibleSessions:s,refreshing:i,servers:p}=Pe(o),u=_({config:{webhooks:[]}}),d=_(!1),r=_(void 0),m=_(!1),S=_(!1),k=_(10);_(null);const b=_({}),V=_(null),y=_([]),C=O(()=>y.value.filter(I=>G.value[`session-action-${I.server.id}-${I.name}`])),f=_(!1),E=_(!1),A=_(!1),H=_(!1),T=_(!1),G=_({});function X(I,x){switch(I){case"startSession":f.value=x;break;case"restartSession":E.value=x;break;case"stopSession":A.value=x;break;case"logoutSession":H.value=x;break;case"deleteSession":T.value=x;break}}async function M(I){X(I,!0);try{for(const x of C.value)await G.value[`session-action-${x.server.id}-${x.name}`][I]()}finally{X(I,!1)}}Ns(()=>{G.value=[]}),Ms(()=>{Ve()});const L=_([{field:"name",header:"Name"},{field:"metadata",header:"Metadata"},{field:"me",header:"Me"},{field:"status",header:"Status"},{field:"server",header:"Server"}]);function w(){return JSON.parse(localStorage.getItem("sessions.table.columns.hidden"))||[]}const $=w(),q=_(se.differenceBy(L.value,$,"field")),F=I=>{q.value=L.value.filter(x=>I.includes(x))};function W(I){return!q.value||q.value.length===0?!0:se.find(q.value,{field:I})}const te=O(()=>W("name")),oe=O(()=>W("metadata")),ne=O(()=>W("me")),le=O(()=>W("status")),ke=O(()=>W("server")),Ce=O(()=>se.differenceBy(L.value,q.value,"field"));Z(()=>Ce.value,I=>{localStorage.setItem("sessions.table.columns.hidden",JSON.stringify(I))},{deep:!0});const Ve=()=>{b.value={global:{value:null,matchMode:_e.CONTAINS},status:{value:null,matchMode:_e.EQUALS},"server.id":{value:null,matchMode:_e.EQUALS},name:{operator:As.AND,constraints:[{value:null,matchMode:_e.STARTS_WITH}]}}};function De(){const I=p.value.find(x=>x.connected);if(!I){n.add({severity:"error",summary:"No connected server",detail:"Please connect to a server first",life:3e3});return}u.value={server:I.id,name:"",config:{metadata:{},webhooks:[{url:"https://httpbin.org/post",events:["session.status","message"],hmac:{key:null},retries:{delaySeconds:1,attempts:15,policy:"exponential"},customHeaders:null}],noweb:{markOnline:!0,store:{enabled:!0,fullSync:!1}},proxy:{}}},r.value="new",d.value=!0}function Re(I){u.value=se.cloneDeep({name:I.name,status:I.status,server:I.server.id,config:I.config}),r.value="update",d.value=!0}function re(){be("store",async()=>await o.refresh())}function Ee(I){m.value=!0,u.value=I}function ie(I){u.value=I,S.value=!0}Z(S,I=>{I||(u.value={config:{webhooks:[]}})});const P=O(()=>["name","me.id","me.pushName","_metadata"]);return(I,x)=>{const Ae=qe,Te=K,ds=rt,ps=Qe,ms=js,vs=de,fs=Bs,ae=Ue,_s=dt,hs=Ne,gs=$t,je=Je,bs=Oe,ys=Ze,$s=rs,Ss=xt,ws=Le,xs=es,ks=vo,Cs=Fo,Vs=nl,fe=Q("tooltip");return a(),g(j,null,[e("div",Nl,[e("div",null,[e("h5",Ml,[Al,jl,l(Ae,{refreshing:c(i)},null,8,["refreshing"])])]),e("div",null,[N((a(),g("button",{onClick:re,class:"p-link layout-topbar-button",disabled:c(i)},ql,8,Bl)),[[fe,"Refresh",void 0,{top:!0}]])])]),l(ws,{selection:y.value,"onUpdate:selection":x[6]||(x[6]=h=>y.value=h),value:c(s).length>0?c(s):[],paginator:!0,rows:k.value,rowsPerPageOptions:[5,10,20,50,100,500],dataKey:h=>`${h.server.id}-${h.name}`,rowHover:!0,filters:b.value,"onUpdate:filters":x[7]||(x[7]=h=>b.value=h),filterDisplay:"row",loading:V.value,globalFilterFields:c(P),showGridlines:"",style:{"white-space":"nowrap"},sortField:"name",sortOrder:1,resizableColumns:""},{header:v(()=>[e("div",Fl,[e("div",Wl,[l(Te,{label:"Start New",icon:"pi pi-play",severity:"success",onClick:De})]),e("div",Kl,[l(ds),e("div",zl,[l(ps,{placeholder:"Columns",modelValue:q.value,options:L.value,optionLabel:"header",selectedItemsLabel:"Columns",maxSelectedLabels:0,"onUpdate:modelValue":F},null,8,["modelValue","options"])]),l(fs,{iconPosition:"left"},{default:v(()=>[l(ms,{class:"pi pi-search"}),l(vs,{modelValue:b.value.global.value,"onUpdate:modelValue":x[0]||(x[0]=h=>b.value.global.value=h),placeholder:"Search by name, phone, metadata",style:{width:"100%"}},null,8,["modelValue"])]),_:1})])])]),empty:v(()=>[U(" No sessions found")]),loading:v(()=>[U(" Loading sessions...")]),default:v(()=>[l(ae,{selectionMode:"multiple",headerStyle:"width: 3rem"}),c(te)?(a(),R(ae,{key:0,field:"name",header:"Name",sortable:""})):D("",!0),c(oe)?(a(),R(ae,{key:1,header:"Metadata"},{body:v(({data:h})=>{var Y;return[l(_s,{metadata:(Y=h.config)==null?void 0:Y.metadata},null,8,["metadata"])]}),_:1})):D("",!0),c(ne)?(a(),R(ae,{key:2,header:"Me"},{body:v(({data:h})=>[e("div",Ql,[l(hs,{session:h},null,8,["session"])])]),_:1})):D("",!0),c(le)?(a(),R(ae,{key:3,field:"status",header:"Status",showFilterMenu:!1,style:{width:"9rem"}},{body:v(({data:h})=>[e("div",Gl,[e("div",null,[l(Ll,{session:h},null,8,["session"])]),e("div",null,[l(gs,{session:h},null,8,["session"])]),e("div",null,[N(l(Te,{icon:"pi pi-whatsapp",severity:"",rounded:"",outlined:"",disabled:h.status!=="WORKING",onClick:Y=>ie(h)},null,8,["disabled","onClick"]),[[fe,"Chat UI",void 0,{top:!0}]])]),e("div",null,[N(l(Te,{icon:"pi pi-code",severity:"secondary",rounded:"",outlined:"",onClick:Y=>Ee(h)},null,8,["onClick"]),[[fe,"Send Request",void 0,{top:!0}]])]),e("div",Xl,[l(je,{status:h.status,value:h.status.toUpperCase()},null,8,["status","value"])])])]),filter:v(({filterModel:h,filterCallback:Y})=>[l(bs,{modelValue:h.value,"onUpdate:modelValue":ee=>h.value=ee,options:c(ll),onChange:ee=>Y(),placeholder:"Any",class:"p-column-filter",showClear:!0},{option:v(({option:ee})=>[l(je,{status:ee,value:ee},null,8,["status","value"])]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1})):D("",!0),c(ke)?(a(),R(ae,{key:4,field:"server.name",filterField:"server.id",header:"Server",showFilterMenu:!1},{filter:v(({filterModel:h,filterCallback:Y})=>[l(ys,{placeholder:"Any",onChange:ee=>Y(),modelValue:h.value,"onUpdate:modelValue":ee=>h.value=ee,showClear:!0,required:!1},null,8,["onChange","modelValue","onUpdate:modelValue"])]),body:v(({data:h})=>[U(B(h.server.name)+" ",1),h.assignedWorker&&h.server.name!==h.assignedWorker?N((a(),g("i",Yl,null,512)),[[fe,`Assigned Worker ID does not match

ðŸ‘‰ Assigned Worker ID: ${h.assignedWorker}`]]):D("",!0)]),_:1})):D("",!0),l(ae,{showFilterMenu:!1},{filter:v(()=>[e("div",Jl,[l($s,{group:"dialog",name:`'${c(C).length}' sessions`,"all-disabled":c(C).length===0,"hide-actions":["view"],"is-starting":f.value,"is-restarting":E.value,"is-stopping":A.value,"is-logging-out":H.value,"is-removing":T.value,onStart:x[1]||(x[1]=h=>M("startSession")),onRestart:x[2]||(x[2]=h=>M("restartSession")),onStop:x[3]||(x[3]=h=>M("stopSession")),onLogout:x[4]||(x[4]=h=>M("logoutSession")),onDelete:x[5]||(x[5]=h=>M("deleteSession"))},null,8,["name","all-disabled","is-starting","is-restarting","is-stopping","is-logging-out","is-removing"])])]),body:v(({data:h})=>[l(Ss,{ref:Y=>{G.value[`session-action-${h.server.id}-${h.name}`]=Y},session:h,disabled:c(C).length!==0,onView:Re},null,8,["session","disabled"])]),_:1})]),_:1},8,["selection","value","rows","dataKey","filters","loading","globalFilterFields"]),l(xs),l(ks,{visible:S.value,"onUpdate:visible":x[8]||(x[8]=h=>S.value=h),session:u.value,"onUpdate:session":x[9]||(x[9]=h=>u.value=h)},null,8,["visible","session"]),l(Cs,{visible:m.value,"onUpdate:visible":x[10]||(x[10]=h=>m.value=h),session:u.value,"onUpdate:session":x[11]||(x[11]=h=>u.value=h)},null,8,["visible","session"]),l(Vs,{visible:d.value,"onUpdate:visible":x[12]||(x[12]=h=>d.value=h),session:u.value,"onUpdate:session":x[13]||(x[13]=h=>u.value=h),mode:r.value},null,8,["visible","session","mode"])],64)}}};export{rt as _,Oi as a};
